import numpy as np
import glob
from tqdm import tqdm


remap_lut = [0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 1, 2, 255,
             5, 255, 3, 5, 255, 4, 255, 5, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 6, 7, 8, 255, 255, 255, 255, 255, 255,
             255, 9, 255, 255, 255, 10, 255, 255, 255, 11, 12, 13, 14,
             255, 255, 255, 255, 255, 255, 255, 255, 9, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 15, 16, 17, 255, 255, 255, 255, 255,
             255, 255, 18, 19, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 1, 7, 6, 8, 5, 5, 4, 5,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
             255, 255, 255, 255, 255, 255, 255, 255]

remap_lut = np.array(remap_lut, dtype=np.int32)

def check_preds(seq_n):

    files = glob.glob("/mnt/Data/Dataset/Kitti/test_labels/sequences/{}/predictions/*.label".format(seq_n),
                      recursive=True)
    all_invalid_vals = []
    for f in tqdm(files):
        label = np.fromfile(f, dtype=np.uint16)
        label_remap = remap_lut[label]
        elements = list(set(label_remap))
        for ele in elements:
            if ele >= 20:
                all_invalid_vals += list(set(label[np.where(label_remap == 255)]))
                # print("fuck!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
                # print(elements)
                # print(f)
    print("##################################")
    print(set(all_invalid_vals))
    print("{} done!".format(seq_n))

for i in range(11,22):
    check_preds(i)
